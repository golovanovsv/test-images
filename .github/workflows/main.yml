name: images
on:
  schedule:
  - cron: "31 2 * * 2"
  push:
    branches:
    - master
jobs:
  build-ubuntu-16.04:
    env:
      VERSION: "16.04"
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: build 
      run: docker build --pull --build-arg VERSION=$VERSION -f ubuntu-systemd.dockerfile -t golovanovsv/ubuntu:$VERSION-systemd .
    - name: push image
      run: docker push golovanovsv/ubuntu:18.04-systemd
  build-ubuntu-18.04:
    env:
      VERSION: "18.04"
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: build 
      run: docker build --pull --build-arg VERSION=$VERSION -f ubuntu-systemd.dockerfile -t golovanovsv/ubuntu:$VERSION-systemd .
  login:
    needs:
    - "ubuntu-16.04"
    - "ubuntu-18.04"
    runs-on: ubuntu-latest
    steps:
    - name: login to docker hub
      run: echo "${{ secrets.DHUB_TOKEN }}" | docker login -u ${{ secrets.DHUB_USERNAME }} --password-stdin
  push-ubuntu-16.04:
    env:
      VERSION: "16.04"
    needs:
    - "login"
    steps:
    - name: push
      run: docker push golovanovsv/ubuntu:$VERSION-systemd
  push-ubuntu-18.04:
    env:
      VERSION: "18.04"
    needs:
    - "login"
    steps:
    - name: push
      run: docker push golovanovsv/ubuntu:$VERSION-systemd
